<?xml version="1.0" encoding="UTF-8"?>
<Module>
<ModulePrefs title="Beauty Bar Google Docs Gadget"
	     title_url="http://beauty-bar.appspot.com/"
             description="Beauty Bar / Beta version (http://beauty-bar.appspot.com/) is a tool to create nice charts. Beta version does only allow data that have two columns (names and values) and six rows. Output is SVG image, which might not work with all browsers."
             author="Ilpo Stenberg"
             author_affiliation="Beauty Bar"
             author_email="istenber@gmail.com"
             screenshot="http://beauty-bar.appspot.com/images/spreadsheet-image.png"
             thumbnail="http://beauty-bar.appspot.com/images/spreadsheet-thumb.png" >
<Require feature="idi" />
<Require feature="locked-domain" />
</ModulePrefs>
<UserPref name="_style_name" display_name="Style name"
          default_value="0" datatype="enum" required="true">
<EnumValue value="nature" display_value="Nature"/>
<EnumValue value="plain" display_value="Plain"/>
<EnumValue value="standard" display_value="Standard"/>
<EnumValue value="other" display_value="Other..."/>
</UserPref>
<UserPref name="_style_name_other" display_name="Style name, if other" />
<UserPref name="_table_query_url" display_name="Data source url" 
          required="true"/>
<UserPref name="_table_query_refresh_interval" 
          display_name="Data refresh interval (minutes)" 
          default_value="0" datatype="enum" required="false">
<EnumValue value="0" display_value="Do not refresh"/>
<EnumValue value="60" display_value="1"/>
<EnumValue value="300" display_value="5"/>
<EnumValue value="1800" display_value="30"/>
</UserPref>
<Content type="html"
	 preferred_height="300"
	 preferred_width="200"><![CDATA[

<script type="text/javascript" src="http://beauty-bar.appspot.com/svgweb/svg.js"
	data-path="http://beauty-bar.appspot.com/svgweb"></script>
<script src="http://www.google.com/jsapi" type="text/javascript"></script>

<div id="my_chart" style="overflow: auto;">
Receiving data from <a href="http://beauty-bar.appspot.com" target="_top">http://beauty-bar.appspot.com</a>, please wait.
</div>

<script>

var beautybar_url = 'http://beauty-bar.appspot.com/';
var style_name = 'standard';

_IG_RegisterOnloadHandler(createChart);

function createChart() {
  var prefs = new _IG_Prefs();
  style_name = prefs.getString("_style_name");
  if(style_name == "other") {
    style_name = prefs.getString("_style_name_other");
  }
  var datasource_url = convertAmpersand(prefs.getString("_table_query_url"));
  var size = document.body.clientWidth + "x" + document.body.clientHeight;
  var url = beautybar_url + "gadget?datasource=\"" + datasource_url + "\"" +
            "&size=" + size + "&style=" + style_name;
  var svg_image = document.createElement('object', true);
  svg_image.setAttribute('type', 'image/svg+xml');
  svg_image.setAttribute('data', url);
  svg_image.setAttribute('id', 'o_img');
  var my_chart = _gel('my_chart');
  my_chart.innerHTML = '';
  svgweb.appendChild(svg_image, my_chart);
};

function convertAmpersand(text) {
  return text.replace(/&/g, '_amp_');
}

function escapeHtml(text) {
  if (text == null) {
    return '';
  }
  return _hesc(text);
} 

</script> 
]]>
</Content>
</Module>
